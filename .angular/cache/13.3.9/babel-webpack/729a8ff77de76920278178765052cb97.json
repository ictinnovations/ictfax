{"ast":null,"code":"import { DataSource } from '@angular/cdk/collections';\nimport { BehaviorSubject } from 'rxjs/BehaviorSubject';\nimport { merge } from 'rxjs';\nexport class UserDataSource extends DataSource {\n  constructor(userDatabase, _sort, _paginator) {\n    super();\n    this.userDatabase = userDatabase;\n    this._sort = _sort;\n    this._paginator = _paginator;\n    this._filterChange = new BehaviorSubject('');\n    this.filteredData = [];\n    this.renderedData = [];\n\n    this._filterChange.subscribe(() => this._paginator.pageIndex = 0);\n  }\n\n  get filter() {\n    return this._filterChange.value;\n  }\n\n  set filter(filter) {\n    this._filterChange.next(filter);\n  }\n\n  connect() {\n    const displayDataChanges = [this.userDatabase.dataChange, this._sort.sortChange, this._filterChange, this._paginator.page];\n    return merge(...displayDataChanges).map(() => {\n      // Filter data\n      this.filteredData = this.userDatabase.data.slice().filter(item => {\n        let searchStr = (item.username + item.first_name + item.last_name + item.email).toLowerCase();\n        return searchStr.indexOf(this.filter.toLowerCase()) != -1;\n      }); // Sort filtered data\n\n      const sortedData = this.getSortedData(this.filteredData.slice()); // Grab the page's slice of the filtered sorted data.\n\n      const startIndex = this._paginator.pageIndex * this._paginator.pageSize;\n      this.renderedData = sortedData.splice(startIndex, this._paginator.pageSize);\n      return this.renderedData;\n    });\n  }\n\n  disconnect() {}\n\n  getSortedData(data) {\n    if (!this._sort.active || this._sort.direction === '') {\n      return data;\n    }\n\n    return data.sort((a, b) => {\n      let propertyA = '';\n      let propertyB = '';\n\n      switch (this._sort.active) {\n        case 'ID':\n          [propertyA, propertyB] = [a.user_id, b.user_id];\n          break;\n\n        case 'username':\n          [propertyA, propertyB] = [a.username, b.username];\n          break;\n\n        case 'first_name':\n          [propertyA, propertyB] = [a.first_name, b.first_name];\n          break;\n\n        case 'last_name':\n          [propertyA, propertyB] = [a.last_name, b.last_name];\n          break;\n\n        case 'email':\n          [propertyA, propertyB] = [a.email, b.email];\n          break;\n      }\n\n      const valueA = isNaN(+propertyA) ? propertyA : +propertyA;\n      const valueB = isNaN(+propertyB) ? propertyB : +propertyB;\n      return (valueA < valueB ? -1 : 1) * (this._sort.direction === 'asc' ? 1 : -1);\n    });\n  }\n\n}","map":null,"metadata":{},"sourceType":"module"}